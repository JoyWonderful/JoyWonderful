## Introduction

通过 GitHub 下载此脚本，点击"Raw" | [GreasyFork](https://greasyfork.org/zh-CN/scripts/565723-%E5%93%94%E5%93%A9%E5%93%94%E5%93%A9%E6%BC%AB%E7%94%BB%E4%B8%8B%E8%BD%BD)  
若有问题/失效了，还请提 issue ~~，随缘更新~~。

这个用户脚本主要是用于（在前端）慢慢缓存 B站 漫画用的，适合**不着急下载漫画**，**不要求高画质**，但想*（边看边）缓存漫画*/*受不了网页菜单乱跳且有广告*的人。  
如果您只是想直接通过服务器下载高清图片，这个脚本做不到。我目前也找不到可以达到此要求并且可以使用的项目（有一个[项目](https://github.com/Zeal-L/BiliBili-Manga-Downloader)已经失效了）。

将哔哩哔哩漫画网页端 `canvas` 内的漫画图片用 `toBlob()` 下载下来。  
~~附赠~~隐藏“下载APP”广告、在分页间添加红线、移除烦人的菜单顶部和菜单阴影。  
支持**单话下载**、**下载整部漫画**（通过自动翻页和点击下一话）。

## Usage

在开始下载之前，请：   
打开浏览器设置 => 找到“下载”相关选项 => 关闭“总是询问保存至何处”（意思相近的选项）并选择一个要保存的路径。  
保存的文件名为 `<三位话数>-<两位页码>.png`，不喜欢可以修改代码 `download_manga` 函数 `fname`。

开始下载：打开用户脚本管理器（如 TamperMonkey/篡改猴），选择选项下载这一话/自动下载整本即可。  
停止自动下载：刷新即可。

## Disclaimer / 免责声明

供学习交流使用，请不要拿它来盗版漫画。  
~~脚本下载很慢，也没有破解付费的功能。~~

## License

许可证为 [GPL-3.0-or-later](https://github.com/JoyWonderful/JoyWonderful/blob/main/userjs/bili-manga-downloader.LICENSE.txt)。

--------------------

> **Note**: 以下都是无关紧要的。

## How it works

- 反“反下载”：  
  ~~蜀黍我啊，最讨厌别人下载我好东西了，不然我该怎么赚钱啊？？？~~ 网页端在不断清除控制台的同时替换 `console` 日志函数、`HTMLCanvasElement.prototype.**` （一系列 `canvas` 原型函数，包括 `toBlob()`）来反调试、反下载（但也许也是为了某种特殊需求无意为之，我不了解）。  
  通过运行于 `document-start` 抢先将 `console.clear()` 替换为空函数、备份原型函数到全局变量中再在之后替换来正常下载。  
  ~~其实很简单。~~
- 下载单话：很简单，就是用 `toBlob()` 然后再创建 `a` 锚元素并点击它以下载。（我知道 `GM_download`，但它有一些不确定因素）
- 下载整本：通过更改中间页数进度条的值并触发 `change` 事件来更改页数以促使加载；自动点击“下一话”按钮和持续监测加载情况来继续“下载整本”操作。

想了解去就去看看代码吧。

## Will I be banned? / 蜀黍会封我吗

理论上应该不会，因为这个脚本是模拟用户操作的，没有直接从服务器请求数据；没有破解付费（~~是因为作者太菜了，不会~~）；模拟翻页下载的也很慢。~~虽然我正常下载了一整本，但我没登账号试过。~~还是建议不要登账号，除非你很想下载账号内的已付费内容。